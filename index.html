<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Scraper Blog Sakurazaka46 (Tag Mentah + Terjemahan + Romaji)</title>
<script src="https://unpkg.com/wanakana"></script>
<style>
    body { font-family: Arial; padding: 20px; max-width: 900px; margin: auto; }
    input { width: 100%; padding: 10px; font-size: 16px; }
    button { padding: 10px 15px; margin-top: 10px; font-size: 16px; }
    h3 { margin-top: 40px; }
    pre { background: #f0f0f0; padding: 15px; border-radius: 6px; white-space: pre-wrap; word-break: break-word; }
</style>
</head>
<body>

<h2>Ambil Box Artikel (Tag Mentah + Terjemahan + Romaji via Wanakana)</h2>

<input id="urlInput" placeholder="Tempel link blog Sakurazaka46 di sini">
<button onclick="scrape()">Ambil Artikel</button>

<div id="resultFinal"></div>

<script>
let articleLines = [];

// ------------------- Scrape -------------------
async function scrape() {
    const url = document.getElementById("urlInput").value;
    if (!url) return alert("Masukkan URL dulu!");
    document.getElementById("resultFinal").innerHTML = "Mengambil data...";

    try {
        const proxyURL = "https://api.allorigins.win/get?url=" + encodeURIComponent(url);
        const res = await fetch(proxyURL);
        const data = await res.json();

        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, "text/html");
        const article = doc.querySelector("div.box-article");
        if (!article) {
            document.getElementById("resultFinal").innerHTML = "Tidak menemukan box-article";
            return;
        }

        let html = article.innerHTML;

        // tambahkan sakurazaka46.com ke semua src gambar
        html = html.replace(/<img\s+src="(\/[^"]*)"/g, '<img src="https://sakurazaka46.com$1"');

        // split menjadi baris sesuai <br>, tetap menyertakan tag
        articleLines = html
            .split(/(<br\s*\/?>)/i)
            .map(line => line.trim())
            .filter(line => line.length > 0);

        await buildOutputFinal();

    } catch (err) {
        document.getElementById("resultFinal").innerHTML = "Error: " + err.message;
    }
    document.getElementById("finalContent").textContent = finalLines.join("\n");
}

// ------------------- OUTPUT FINAL -------------------
async function buildOutputFinal() {
    async function translate(text){
        try {
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=ja&tl=id&dt=t&q=${encodeURIComponent(text)}`);
            const data = await res.json();
            return data[0].map(t => t[0]).join('');
        } catch(e) {
            return "(gagal translate)";
        }
    }

    let promises = articleLines.map(async line => {
        // ambil text untuk translate dan romaji, tapi tetap simpan tag utuh di output
        let textOnly = line.replace(/<[^>]+>/g, "").trim();
        if(textOnly.length === 0) return line; // baris hanya tag

        let terjemah = await translate(textOnly);
        let romaji = wanakana.toRomaji(textOnly);

        // Tambahkan <br /> di akhir block supaya ketika dicopy ke blog ada baris kosong
         return `${line}<br />\n→ ${terjemah}<br />\n${romaji}<br />`;
    });

    let finalLines = await Promise.all(promises);

    // tampilkan menggunakan textContent supaya tag tetap terlihat
    document.getElementById("resultFinal").innerHTML = `
        <h3>OUTPUT — Blog + Terjemahan + Romaji</h3>
        <pre id="finalContent"></pre>
        <button onclick="copyFinal()">Copy</button>
    `;

    document.getElementById("finalContent").textContent = finalLines.join("\n");
}

function copyFinal() {
    const content = document.getElementById("finalContent").textContent;
    navigator.clipboard.writeText(content).then(() => {
        alert("Teks berhasil dicopy!");
    });
}
</script>

</body>
</html>
